# config.yaml

model:

  # 观测级样条设置（从 X_obs_names 中选）
  spline_features: []  # 移除 judge_score_season_zscore_x_cumulative_avg_score
  n_spline_knots: 5
  spline_degree: 3

  # 名人级样条设置（从 X_celeb_names 中选）
  celeb_spline_features:
    - age  # 倒U型非线性

  # 排除的观测特征（减少共线性）
  exclude_obs_features:
    - youtube_comment_count_norm  # 与 youtube_view_count_norm 高度相关 r=0.96
    - pro_is_male                 # 与 is_male 高度相关 r=-0.89

  # 排除的名人特征（解决多重共线性）
  exclude_celeb_features:
    - "industry_Performing Arts & Entertainment"  # 作为参考类别（样本最多51%）
    - is_international  # 与 log_us_state_pop 高度相关 r=-0.988

  # 舞者特征在 X_obs 中（pro_prev_wins, pro_avg_rank, pro_is_male）
  # X_pro 不存在，此设置无效
  use_pro_features: false

  # 名人特征交互项
  celeb_interaction_features: null

  # 观测特征交互项（基于BART交互检测结果）
  obs_interaction_features:
    # 高重要性交互项（importance > 0.10）
    - "judge_score_season_zscore * times_in_bottom"  # 评委分×濒死次数，捕捉"评委不喜欢但粉丝救"
    - "times_in_bottom * celeb_fans_week_ratio"      # 濒死次数×粉丝周比例
    - "teflon_factor * celeb_fans_week_ratio"        # 铁氟龙效应×粉丝周比例
    - "judge_score_season_zscore * weeks_survived"   # 评委分效应随周数变化
    - "teflon_factor * judge_score_season_zscore"    # 铁氟龙×评委分
    # 中等重要性交互项（importance > 0.08）
    - "score_trend * cumulative_avg_score"           # 分数趋势×累计均分
    - "score_trend * times_in_bottom"                # 分数趋势×濒死次数
    - "score_trend * weeks_survived"                 # 分数趋势×存活周数
    # 保留原有的
    - "teflon_factor * times_in_bottom"              # 铁氟龙效应×濒死次数，SNR=2.58
    - "pro_avg_rank * judge_score_season_zscore"     # 舞者历史排名×当周分数

  # 正向先验特征（系数强制为正）
  positive_prior_features:
    - judge_score_season_zscore  # 观众分与评委分正相关

  # 特征中心化
  center_features: true

  # 正则化（交互项多时建议开启）
  use_horseshoe: true  # 开启 Horseshoe，自动稀疏化不重要的交互项

  # 似然函数
  tau_init: 1.0
  learn_tau: true

  # P_fan 归一化方式
  p_fan_normalize: softmax  # 'linear' or 'softmax'
  t_fan_init: 2.0           # softmax 温度参数（高温度 → 更平滑，保留小值差异）
  learn_t_fan: true         # 是否学习温度参数

  # 评委拯救修正
  use_judge_save_correction: true  # 是否启用评委拯救修正
  theta_save_scale: 1.0            # θ_save 先验尺度 (HalfNormal)

  # 约束
  sum_to_zero: true

  # 观测级噪声（Student-t 分布）
  obs_noise: false          # 关闭观测级噪声以加速训练
  obs_noise_df: null        # 自由度，null 表示从数据学习

  # 名人/舞者效应使用 Student-t 分布
  use_student_t_effects: false # 是否对 alpha/delta 使用 Student-t
  celeb_df: null               # 名人效应自由度，null 表示学习
  pro_df: null                 # 舞者效应自由度，null 表示学习

prior:
  # 方案2：收紧名人随机效应先验，迫使模型用特征解释名人差异
  # InverseGamma(a, b) 均值 = b/(a-1)
  # 原: a=2, b=1 → 均值=1.0
  # 新: a=10, b=1 → 均值=0.11
  sigma_celeb: { a: 10.0, b: 1.0 }
  sigma_pro: { a: 2.0, b: 1.0 }
  sigma_obs: { a: 2.0, b: 1.0 }   # 观测噪声尺度先验
  obs_df_prior: { a: 2.0, b: 0.1 } # 自由度先验 Gamma(2, 0.1)，均值20
  celeb_df_prior: { a: 2.0, b: 0.1 } # 名人效应自由度先验
  pro_df_prior: { a: 2.0, b: 0.1 }   # 舞者效应自由度先验
  beta_celeb_scale: 1.0   # 收紧名人特征先验（从2.5降到1.0）
  beta_pro_scale: 1.0     # 收紧舞者特征先验
  beta_obs_scale: 1.0     # 收紧观测特征先验（替代Horseshoe）
  spline_smoothing_scale: 1.0

sampling:
  n_chains: 4        # 4条链检验收敛
  n_tune: 500       # 1000次预热
  n_samples: 1000    # 2000次正式采样
  target_accept: 0.85 # 目标接受率
  random_seed: 42
  cores: 4           # 并行核数

output:
  dir: outputs/model
  save_trace: true
